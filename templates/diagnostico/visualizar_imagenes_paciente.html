<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f7fc;
        color: #333;
        margin: 0;
        padding: 20px;
    }
    h1 {
        text-align: center;
        color: #4CAF50;
        margin-bottom: 20px;
    }
    .image-gallery {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
    }
    .image-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease-in-out;
    }
    .image-item img {
        display: block;
        max-width: 100%;
        height: auto;
        border-radius: 8px;
    }
    .image-item:hover {
        transform: scale(1.05);
    }
    .image-caption {
        position: absolute;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        width: 100%;
        text-align: center;
        padding: 10px;
        font-size: 1rem;
    }
</style>
<script>
    function analizarImagenes(pacienteId) {
        fetch(`/analizar-imagenes/${pacienteId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Error: ${data.error}`);
                } else {
                    let resultsContainer = document.getElementById('analysis-results');
                    resultsContainer.innerHTML = '';
                    data.resultados.forEach(result => {
                        let resultItem = document.createElement('div');
                        resultItem.className = 'visualization-item';
                        resultItem.innerHTML = `
                            <h3>${result.imagen.nombre}</h3>
                            <p>Predicción: ${result.prediccion}</p>
                            <p>Probabilidad: ${(result.probabilidad * 100).toFixed(2)}%</p>
                        `;
                        resultsContainer.appendChild(resultItem);
                    });
                }
            })
            .catch(error => alert(`Error al analizar imágenes: ${error}`));
    }
</script>

<body>
    <h1>Imágenes del Paciente: {{ paciente.nombre }}</h1>
    <form method="POST">
        {% csrf_token %}
        <button type="submit" name="analizar" style="margin: 20px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Analizar Imágenes con IA</button>
    </form>

    {% if resultados_ia %}
        <div id="analysis-results" class="grid-container">
            {% for resultado in resultados_ia %}
                <div class="visualization-item">
                    {% if resultado.error %}
                        <p>Error: {{ resultado.error }}</p>
                    {% else %}
                        <h3>{{ resultado.imagen.nombre }}</h3>
                        <p>Predicción: {{ resultado.prediccion }}</p>
                        <p>Probabilidad: {{ resultado.probabilidad|floatformat:2 }}%</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="grid-container">
        {% if visualizaciones %}
            {% for vis in visualizaciones %}
                <div class="visualization-item">
                    <h3>{{ vis.nombre }}</h3>
                    <img src="{{ vis.ruta }}" alt="{{ vis.nombre }}" class="image-preview">
                </div>
            {% endfor %}
        {% else %}
            <p class="no-images">No hay imágenes disponibles para este paciente.</p>
        {% endif %}
    </div>
</body>